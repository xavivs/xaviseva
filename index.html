<!doctype html>
<html lang="es" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contador de DÃ­as - Xavi se va</title>
  <link rel="icon" type="image/png" href="./assets/favicon.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    .font-heading {
      font-family: 'Outfit', sans-serif;
    }
    
    .font-body {
      font-family: 'Space Grotesk', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(251, 146, 60, 0.3); }
      50% { box-shadow: 0 0 40px rgba(251, 146, 60, 0.6); }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    
    @keyframes confetti-fall {
      0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    @keyframes floating-message {
      0% { 
        opacity: 0;
        transform: translateY(20px) scale(0.8);
      }
      10% { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      90% { 
        opacity: 1;
        transform: translateY(-150px) scale(1);
      }
      100% { 
        opacity: 0;
        transform: translateY(-200px) scale(0.8);
      }
    }
    
    .animate-float {
      animation: float 6s ease-in-out infinite;
    }
    
    .animate-float-delayed {
      animation: float 6s ease-in-out infinite 2s;
    }
    
    .animate-pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .shimmer-text {
      background: linear-gradient(90deg, currentColor 40%, #fbbf24 50%, currentColor 60%);
      background-size: 200% auto;
      -webkit-background-clip: text;
      background-clip: text;
      animation: shimmer 3s linear infinite;
    }
    
    .countdown-card {
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .countdown-card:hover {
      transform: translateY(-5px) scale(1.02);
    }
    
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      top: -10px;
      animation: confetti-fall linear forwards;
      pointer-events: none;
      z-index: 50;
    }
    
    .floating-message {
      position: fixed;
      z-index: 100;
      animation: floating-message 4s ease-out forwards;
      pointer-events: none;
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
  </style>
</head>
<body class="h-full font-body">
  <div id="app-wrapper" class="w-full h-full overflow-auto relative" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);">
    <!-- Confetti container -->
    <div id="confetti-container"></div>
    
    <!-- Floating decorations -->
    <div class="absolute top-10 left-10 text-6xl animate-float opacity-60">
      ðŸŽ‰
    </div>
    <div class="absolute top-20 right-16 text-5xl animate-float-delayed opacity-60">
      ðŸŽŠ
    </div>
    <div class="absolute bottom-20 left-20 text-5xl animate-float opacity-60">
      âœ¨
    </div>
    <div class="absolute bottom-32 right-10 text-6xl animate-float-delayed opacity-60">
      ðŸŽˆ
    </div>
    
    <!-- Main content -->
    <div class="relative z-10 flex flex-col items-center justify-center min-h-full px-4 py-12">
      <!-- Header -->
      <div class="text-center mb-12">
        <h1 id="main-title" class="font-heading text-5xl md:text-7xl font-extrabold mb-4" style="color: #fb923c;">Â¡Me voy! ðŸ‘‹</h1>
        <p id="subtitle" class="text-xl md:text-2xl font-light" style="color: #94a3b8;">Cuenta atrÃ¡s para mi Ãºltimo dÃ­a</p>
      </div>
      
      <!-- Countdown -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-12 max-w-4xl w-full">
        <div class="countdown-card rounded-2xl p-6 text-center animate-pulse-glow" style="background: rgba(251, 146, 60, 0.1); border: 1px solid rgba(251, 146, 60, 0.3);">
          <div id="days" class="font-heading text-5xl md:text-7xl font-bold mb-2" style="color: #fb923c;">
            --
          </div>
          <div class="text-sm md:text-base uppercase tracking-widest font-medium" style="color: #94a3b8;">
            DÃ­as
          </div>
        </div>
        <div class="countdown-card rounded-2xl p-6 text-center" style="background: rgba(251, 146, 60, 0.1); border: 1px solid rgba(251, 146, 60, 0.3);">
          <div id="hours" class="font-heading text-5xl md:text-7xl font-bold mb-2" style="color: #fb923c;">
            --
          </div>
          <div class="text-sm md:text-base uppercase tracking-widest font-medium" style="color: #94a3b8;">
            Horas
          </div>
        </div>
        <div class="countdown-card rounded-2xl p-6 text-center" style="background: rgba(251, 146, 60, 0.1); border: 1px solid rgba(251, 146, 60, 0.3);">
          <div id="minutes" class="font-heading text-5xl md:text-7xl font-bold mb-2" style="color: #fb923c;">
            --
          </div>
          <div class="text-sm md:text-base uppercase tracking-widest font-medium" style="color: #94a3b8;">
            Minutos
          </div>
        </div>
        <div class="countdown-card rounded-2xl p-6 text-center" style="background: rgba(251, 146, 60, 0.1); border: 1px solid rgba(251, 146, 60, 0.3);">
          <div id="seconds" class="font-heading text-5xl md:text-7xl font-bold mb-2" style="color: #fb923c;">
            --
          </div>
          <div class="text-sm md:text-base uppercase tracking-widest font-medium" style="color: #94a3b8;">
            Segundos
          </div>
        </div>
      </div>
      
      <!-- Progress bar with photo slider -->
      <div class="w-full max-w-2xl mb-8">
        <div class="flex justify-between text-sm mb-4" style="color: #94a3b8;">
          <span>Mi viaje hacia la libertad</span>
          <span id="progress-percent">0%</span>
        </div>
        <div class="relative mb-8">
          <!-- Bar track -->
          <div class="relative h-3 rounded-full overflow-hidden" style="background: rgba(251, 146, 60, 0.2); border: 1px solid rgba(251, 146, 60, 0.5);">
            <!-- Animated progress background -->
            <div id="progress-bar" class="progress-bar h-full rounded-full" style="width: 0%; background: linear-gradient(90deg, #fb923c, #f59e0b); transition: width 1s ease-out;"></div>
          </div>
          <!-- Photo slider thumb (positioned absolutely on top) -->
          <div id="slider-thumb" class="absolute -top-7 w-16 h-16 rounded-full border-4 shadow-lg z-20 overflow-hidden transition-all duration-300 group-hover:scale-110" style="left: 0%; border-color: #fb923c; background: #1e293b; transform: translateX(-50%);">
            <img id="thumb-photo" src="./assets/foto-xavi.png" alt="Foto de Xavi" class="w-full h-full object-cover" style="display: block;">
            <div id="thumb-placeholder" class="w-full h-full flex items-center justify-center text-3xl" style="background: rgba(251, 146, 60, 0.2); display: none;">
              ðŸ“¸
            </div>
          </div>
        </div>
        <!-- Start and End labels -->
        <div class="flex justify-between text-xs mb-4" style="color: #64748b;">
          <span id="start-date-label">12 Ene</span>
          <span id="end-date-label">31 Mar ðŸª¦</span>
        </div>
      </div>
      
      <!-- Target date -->
      <div class="text-center mb-8 p-6 rounded-2xl" style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(148, 163, 184, 0.2);">
        <p class="text-sm uppercase tracking-widest mb-2" style="color: #64748b;">Fecha de salida</p>
        <p id="target-date-display" class="font-heading text-2xl md:text-3xl font-bold" style="color: #f1f5f9;">31 de Marzo de 2025 â€¢ 8:00 AM</p>
      </div>
      
      <!-- Farewell message -->
      <div id="farewell-section" class="text-center mb-12">
        <p id="farewell-message" class="text-xl md:text-2xl font-light italic" style="color: #cbd5e1;">"Â¡Gracias por todo, compaÃ±eros! ðŸ’œ"</p>
      </div>
      
      <!-- Comments Section -->
      <div class="w-full max-w-2xl mb-8 p-6 rounded-2xl" style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(148, 163, 184, 0.2);">
        <h3 class="font-heading text-2xl font-bold mb-4" style="color: #f1f5f9;">Dejad vuestros mensajes ðŸ’¬</h3>
        <!-- Comment input -->
        <div class="mb-4">
          <input type="text" id="comment-input" placeholder="Escribe tu mensaje aquÃ­..." class="w-full px-4 py-3 rounded-lg" style="background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(251, 146, 60, 0.3); color: #f1f5f9;" maxlength="100">
          <button id="comment-btn" class="mt-3 w-full px-4 py-2 rounded-lg font-semibold transition-all" style="background: #fb923c; color: #0f172a;">Enviar mensaje</button>
        </div>
        <!-- Comments list -->
        <div id="comments-list" class="max-h-80 overflow-y-auto space-y-3">
          <div class="text-center py-8" style="color: #64748b;">
            <p>AÃºn no hay mensajes de despedida... Â¡DÃ©jame uno antes de que me vaya! ðŸ‘‹</p>
          </div>
        </div>
      </div>
      
      <!-- Hidden celebration message -->
      <div id="celebration" class="hidden text-center">
        <h2 class="font-heading text-4xl md:text-6xl font-bold mb-4" style="color: #fb923c;">ðŸŽ‰ Â¡NUEVO COMIENZO! ðŸŽ‰</h2>
        <p class="text-xl" style="color: #94a3b8;">Â¡Ha llegado el momento! Â¡Gracias por todo! ðŸš€</p>
      </div>
    </div>
  </div>
  
  <script>
    // ============================================
    // CONFIGURACIÃ“N - CAMBIA ESTAS FECHAS AQUÃ
    // ============================================
    
    // Fecha de salida (Ãºltimo dÃ­a de trabajo)
    // Formato: aÃ±o, mes (0-11), dÃ­a, hora, minuto
    const targetDate = new Date(2026, 2, 31, 8, 0); // 31 de marzo de 2026 a las 8:00 AM
    
    // Fecha de inicio (para calcular el progreso)
    const startDate = new Date(2026, 0, 12, 0, 0); // 12 de enero de 2026
    
    // ConfiguraciÃ³n de horario laboral
    const WORK_START_HOUR = 8; // 8:00 AM
    const WORK_END_HOUR = 17; // 5:00 PM
    const LUNCH_START_HOUR = 13; // 1:00 PM
    const LUNCH_END_HOUR = 14; // 2:00 PM
    const HOURS_PER_DAY = 8; // 8 horas laborales por dÃ­a
    
    // Vacaciones: del 27 de febrero al 11 de marzo (incluidos)
    const VACATION_START = new Date(2026, 1, 27, 0, 0); // 27 de febrero de 2026
    const VACATION_END = new Date(2026, 2, 11, 23, 59, 59); // 11 de marzo de 2026
    
    // Mensajes personalizables
    const config = {
      mainTitle: "Â¡Me voy! ðŸ‘‹",
      subtitle: "Cuenta atrÃ¡s para el Ãºltimo dÃ­a de Xavi",
      farewellMessage: "Gracias por todo!! ðŸ–¤"
    };
    
    // ============================================
    // CONFIGURACIÃ“N DE SUPABASE
    // ============================================
    // IMPORTANTE: Reemplaza estos valores con tus credenciales de Supabase
    const SUPABASE_URL = 'TU_SUPABASE_URL'; // Ejemplo: 'https://xxxxx.supabase.co'
    const SUPABASE_ANON_KEY = 'TU_SUPABASE_ANON_KEY'; // Tu clave pÃºblica anÃ³nima
    
    // Inicializar Supabase (se inicializarÃ¡ despuÃ©s de que cargue la pÃ¡gina)
    let supabaseClient = null;
    function initSupabase() {
      if (SUPABASE_URL !== 'TU_SUPABASE_URL' && SUPABASE_ANON_KEY !== 'TU_SUPABASE_ANON_KEY') {
        try {
          // El SDK de Supabase desde CDN puede estar en window.supabase o globalmente
          const supabaseLib = window.supabase || (typeof supabase !== 'undefined' ? supabase : null);
          if (supabaseLib && supabaseLib.createClient) {
            supabaseClient = supabaseLib.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
          }
        } catch (error) {
          console.error('Error inicializando Supabase:', error);
          supabaseClient = null;
        }
      }
    }
    
    // ============================================
    // FUNCIONES DEL CONTADOR
    // ============================================
    
    function formatDate(date) {
      const months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
                     'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
      const day = date.getDate();
      const month = months[date.getMonth()];
      const year = date.getFullYear();
      const hours = date.getHours();
      const minutes = date.getMinutes();
      const ampm = hours >= 12 ? 'PM' : 'AM';
      const displayHours = hours % 12 || 12;
      const displayMinutes = minutes.toString().padStart(2, '0');
      return `${day} de ${month} de ${year} â€¢ ${displayHours}:${displayMinutes} ${ampm}`;
    }
    
    function formatShortDate(date) {
      const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 
                     'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
      return `${date.getDate()} ${months[date.getMonth()]}`;
    }
    
    // FunciÃ³n auxiliar: verificar si un dÃ­a es laborable (lunes a viernes)
    function isWorkday(date) {
      const day = date.getDay();
      return day !== 0 && day !== 6; // No domingo (0) ni sÃ¡bado (6)
    }
    
    // FunciÃ³n auxiliar: verificar si un dÃ­a estÃ¡ en vacaciones
    function isVacation(date) {
      return date >= VACATION_START && date <= VACATION_END;
    }
    
    // FunciÃ³n auxiliar: verificar si una fecha/hora estÃ¡ en horario laboral
    function isWorkHours(date) {
      const hour = date.getHours();
      const minute = date.getMinutes();
      const timeInMinutes = hour * 60 + minute;
      const workStartMinutes = WORK_START_HOUR * 60;
      const lunchStartMinutes = LUNCH_START_HOUR * 60;
      const lunchEndMinutes = LUNCH_END_HOUR * 60;
      const workEndMinutes = WORK_END_HOUR * 60;
      
      return (timeInMinutes >= workStartMinutes && timeInMinutes < lunchStartMinutes) ||
             (timeInMinutes >= lunchEndMinutes && timeInMinutes < workEndMinutes);
    }
    
    // FunciÃ³n auxiliar: obtener horas laborales restantes del dÃ­a actual
    function getRemainingWorkHoursToday(now) {
      if (!isWorkday(now) || isVacation(now)) {
        return 0;
      }
      
      const hour = now.getHours();
      const minute = now.getMinutes();
      const timeInMinutes = hour * 60 + minute;
      const workStartMinutes = WORK_START_HOUR * 60;
      const lunchStartMinutes = LUNCH_START_HOUR * 60;
      const lunchEndMinutes = LUNCH_END_HOUR * 60;
      const workEndMinutes = WORK_END_HOUR * 60;
      
      // Si estamos antes del horario laboral, contamos todo el dÃ­a
      if (timeInMinutes < workStartMinutes) {
        return HOURS_PER_DAY;
      }
      
      // Si estamos en la pausa de comida, contamos las horas de la tarde
      if (timeInMinutes >= lunchStartMinutes && timeInMinutes < lunchEndMinutes) {
        return (workEndMinutes - lunchEndMinutes) / 60;
      }
      
      // Si estamos despuÃ©s del horario laboral, no quedan horas hoy
      if (timeInMinutes >= workEndMinutes) {
        return 0;
      }
      
      // Si estamos en horario de maÃ±ana, contamos lo que queda de maÃ±ana + tarde
      if (timeInMinutes >= workStartMinutes && timeInMinutes < lunchStartMinutes) {
        const remainingMorning = (lunchStartMinutes - timeInMinutes) / 60;
        const afternoonHours = (workEndMinutes - lunchEndMinutes) / 60;
        return remainingMorning + afternoonHours;
      }
      
      // Si estamos en horario de tarde, contamos lo que queda
      if (timeInMinutes >= lunchEndMinutes && timeInMinutes < workEndMinutes) {
        return (workEndMinutes - timeInMinutes) / 60;
      }
      
      return 0;
    }
    
    // FunciÃ³n auxiliar: obtener segundos laborales restantes del dÃ­a actual
    function getRemainingWorkSecondsToday(now) {
      if (!isWorkday(now) || isVacation(now)) {
        return 0;
      }
      
      const hour = now.getHours();
      const minute = now.getMinutes();
      const second = now.getSeconds();
      const timeInSeconds = hour * 3600 + minute * 60 + second;
      
      const workStartSeconds = WORK_START_HOUR * 3600;
      const lunchStartSeconds = LUNCH_START_HOUR * 3600;
      const lunchEndSeconds = LUNCH_END_HOUR * 3600;
      const workEndSeconds = WORK_END_HOUR * 3600;
      
      // Si estamos antes del horario laboral, contamos todo el dÃ­a
      if (timeInSeconds < workStartSeconds) {
        return (lunchStartSeconds - workStartSeconds) + (workEndSeconds - lunchEndSeconds);
      }
      
      // Si estamos en la pausa de comida, contamos las horas de la tarde
      if (timeInSeconds >= lunchStartSeconds && timeInSeconds < lunchEndSeconds) {
        return workEndSeconds - lunchEndSeconds;
      }
      
      // Si estamos despuÃ©s del horario laboral, no quedan segundos hoy
      if (timeInSeconds >= workEndSeconds) {
        return 0;
      }
      
      // Si estamos en horario de maÃ±ana, contamos lo que queda de maÃ±ana + tarde
      if (timeInSeconds >= workStartSeconds && timeInSeconds < lunchStartSeconds) {
        const remainingMorning = lunchStartSeconds - timeInSeconds;
        const afternoonSeconds = workEndSeconds - lunchEndSeconds;
        return remainingMorning + afternoonSeconds;
      }
      
      // Si estamos en horario de tarde, contamos lo que queda
      if (timeInSeconds >= lunchEndSeconds && timeInSeconds < workEndSeconds) {
        return workEndSeconds - timeInSeconds;
      }
      
      return 0;
    }
    
    // FunciÃ³n auxiliar: contar dÃ­as laborables completos entre dos fechas (sin contar el dÃ­a actual)
    function countWorkdaysBetween(start, end) {
      let count = 0;
      const current = new Date(start);
      current.setDate(current.getDate() + 1); // Empezar desde el dÃ­a siguiente
      current.setHours(0, 0, 0, 0);
      
      const endDate = new Date(end);
      endDate.setHours(0, 0, 0, 0);
      
      while (current < endDate) {
        if (isWorkday(current) && !isVacation(current)) {
          count++;
        }
        current.setDate(current.getDate() + 1);
      }
      
      return count;
    }
    
    function updateCountdown() {
      const now = new Date();
      
      if (now >= targetDate) {
        document.getElementById('days').textContent = '0';
        document.getElementById('hours').textContent = '0';
        document.getElementById('minutes').textContent = '0';
        document.getElementById('seconds').textContent = '0';
        document.getElementById('progress-bar').style.width = '100%';
        document.getElementById('slider-thumb').style.left = '100%';
        document.getElementById('progress-percent').textContent = '100%';
        document.getElementById('farewell-section').classList.add('hidden');
        document.getElementById('celebration').classList.remove('hidden');
        createConfettiBurst();
        return;
      }
      
      // Calcular segundos laborales restantes del dÃ­a actual
      let remainingSecondsToday = getRemainingWorkSecondsToday(now);
      
      // Contar dÃ­as laborables completos entre maÃ±ana y la fecha objetivo
      const workdaysRemaining = countWorkdaysBetween(now, targetDate);
      
      // Calcular horas totales laborales restantes
      const totalWorkSeconds = (workdaysRemaining * HOURS_PER_DAY * 3600) + remainingSecondsToday;
      
      // Convertir a dÃ­as, horas, minutos y segundos
      const totalWorkHours = totalWorkSeconds / 3600;
      const days = Math.floor(totalWorkHours / HOURS_PER_DAY);
      const hours = Math.floor(totalWorkHours % HOURS_PER_DAY);
      const minutes = Math.floor((totalWorkSeconds % 3600) / 60);
      const seconds = Math.floor(totalWorkSeconds % 60);
      
      document.getElementById('days').textContent = days;
      document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
      document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
      document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
      
      // Calculate progress (basado en horas laborales)
      // Total de horas laborales desde startDate hasta targetDate
      const startDateWithTime = new Date(startDate);
      startDateWithTime.setHours(WORK_START_HOUR, 0, 0, 0);
      const totalWorkdaysFromStart = countWorkdaysBetween(startDateWithTime, targetDate) + 
                                    (isWorkday(startDateWithTime) && !isVacation(startDateWithTime) ? 1 : 0);
      const totalWorkSecondsFromStart = totalWorkdaysFromStart * HOURS_PER_DAY * 3600;
      
      // Horas transcurridas = totales - restantes
      const elapsedWorkSeconds = totalWorkSecondsFromStart - totalWorkSeconds;
      const progress = totalWorkSecondsFromStart > 0 ? Math.min(100, Math.max(0, (elapsedWorkSeconds / totalWorkSecondsFromStart) * 100)) : 0;
      
      document.getElementById('progress-bar').style.width = progress.toFixed(1) + '%';
      const sliderPos = Math.max(0, Math.min(100, progress));
      document.getElementById('slider-thumb').style.left = sliderPos + '%';
      document.getElementById('progress-percent').textContent = progress.toFixed(1) + '%';
    }
    
    // ============================================
    // ANIMACIONES Y EFECTOS
    // ============================================
    
    function createFloatingMessage() {
      const messages = [
        'ðŸŽ‰', 'ðŸŽŠ', 'âœ¨', 'ðŸ–¤', 'ðŸš€', 'ðŸŒŸ', 'ðŸŽ¯', 'ðŸ”¥',
        'Â¡Nuevo comienzo!', 'Â¡Nueva aventura!', 'Â¡Gracias!', 'Â¡Hasta pronto!', 
        'Â¡A cumplir mis sueÃ±os!', 'Â¡Yay!', 'ðŸ’«', 'âš¡', 'ðŸŒˆ', 'ðŸ’Ž',
        'Â¡Ãšltimo dÃ­a!', 'Â¡Me voy!', 'ðŸ–ï¸', 'âœˆï¸', 'ðŸŒ´', 'ðŸŽ“', 'ðŸ’¼'
      ];
      const message = messages[Math.floor(Math.random() * messages.length)];
      
      const floatingMsg = document.createElement('div');
      floatingMsg.className = 'floating-message';
      floatingMsg.textContent = message;
      floatingMsg.style.left = Math.random() * 80 + 10 + '%';
      floatingMsg.style.bottom = '20px';
      floatingMsg.style.color = ['#fb923c', '#f59e0b', '#fbbf24', '#34d399', '#60a5fa'][Math.floor(Math.random() * 5)];
      
      document.body.appendChild(floatingMsg);
      
      setTimeout(() => floatingMsg.remove(), 4000);
    }
    
    function createFloatingComment() {
      if (comments.length === 0) return;
      
      const randomComment = comments[Math.floor(Math.random() * comments.length)];
      const commentText = randomComment.text.length > 40 
        ? randomComment.text.substring(0, 40) + '...' 
        : randomComment.text;
      
      const floatingMsg = document.createElement('div');
      floatingMsg.className = 'floating-message';
      floatingMsg.style.fontSize = '1.2rem';
      floatingMsg.style.maxWidth = '300px';
      floatingMsg.style.textAlign = 'center';
      floatingMsg.style.padding = '10px';
      floatingMsg.style.background = 'rgba(251, 146, 60, 0.2)';
      floatingMsg.style.backdropFilter = 'blur(10px)';
      floatingMsg.style.borderRadius = '15px';
      floatingMsg.style.border = '1px solid rgba(251, 146, 60, 0.4)';
      floatingMsg.innerHTML = `<div style="font-weight: bold; margin-bottom: 5px;">${escapeHtml(commentText)}</div><div style="font-size: 0.9rem; opacity: 0.8;">${escapeHtml(randomComment.name || 'AnÃ³nimo')}</div>`;
      floatingMsg.style.left = Math.random() * 70 + 15 + '%';
      floatingMsg.style.bottom = '20px';
      floatingMsg.style.color = '#f1f5f9';
      
      document.body.appendChild(floatingMsg);
      
      setTimeout(() => floatingMsg.remove(), 5000);
    }
    
    function createConfetti() {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = Math.random() * 100 + '%';
      confetti.style.backgroundColor = ['#fb923c', '#f59e0b', '#fbbf24', '#34d399', '#60a5fa'][Math.floor(Math.random() * 5)];
      confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
      confetti.style.animationDuration = (Math.random() * 3 + 2) + 's';
      document.getElementById('confetti-container').appendChild(confetti);
      
      setTimeout(() => confetti.remove(), 5000);
    }
    
    function createConfettiBurst() {
      for (let i = 0; i < 50; i++) {
        setTimeout(createConfetti, i * 50);
      }
    }
    
    // Confetti y mensajes ocasionales
    setInterval(() => {
      if (Math.random() > 0.7) createConfetti();
    }, 2000);
    
    setInterval(() => {
      if (Math.random() > 0.6) createFloatingMessage();
    }, 2500);
    
    // Mostrar comentarios como mensajes flotantes (mÃ¡s frecuentes que los mensajes normales)
    setInterval(() => {
      if (comments.length > 0 && Math.random() > 0.5) {
        createFloatingComment();
      }
    }, 2500);
    
    // ============================================
    // SISTEMA DE COMENTARIOS CON SUPABASE
    // ============================================
    
    let comments = [];
    
    // Cargar comentarios desde Supabase
    async function loadComments() {
      if (!supabaseClient) {
        // Fallback a localStorage si Supabase no estÃ¡ configurado
        comments = JSON.parse(localStorage.getItem('despedida_comments')) || [];
        renderComments();
        return;
      }
      
      try {
        const { data, error } = await supabaseClient
          .from('comments')
          .select('*')
          .order('created_at', { ascending: false });
        
        if (error) {
          console.error('Error cargando comentarios:', error);
          // Fallback a localStorage
          comments = JSON.parse(localStorage.getItem('despedida_comments')) || [];
        } else {
          comments = data || [];
        }
        renderComments();
      } catch (error) {
        console.error('Error:', error);
        comments = JSON.parse(localStorage.getItem('despedida_comments')) || [];
        renderComments();
      }
    }
    
    // Guardar comentario en Supabase
    async function saveComment(text, name) {
      if (!supabase) {
        // Fallback a localStorage
        const newComment = {
          text: text,
          name: name,
          date: new Date().toISOString()
        };
        comments.push(newComment);
        localStorage.setItem('despedida_comments', JSON.stringify(comments));
        renderComments();
        return;
      }
      
      try {
        const { data, error } = await supabaseClient
          .from('comments')
          .insert([
            {
              text: text,
              name: name
            }
          ])
          .select();
        
        if (error) {
          console.error('Error guardando comentario:', error);
          // Fallback a localStorage
          const newComment = {
            text: text,
            name: name,
            date: new Date().toISOString()
          };
          comments.push(newComment);
          localStorage.setItem('despedida_comments', JSON.stringify(comments));
        } else {
          // Recargar comentarios desde Supabase
          await loadComments();
        }
      } catch (error) {
        console.error('Error:', error);
        // Fallback a localStorage
        const newComment = {
          text: text,
          name: name,
          date: new Date().toISOString()
        };
        comments.push(newComment);
        localStorage.setItem('despedida_comments', JSON.stringify(comments));
        renderComments();
      }
    }
    
    function renderComments() {
      const commentsList = document.getElementById('comments-list');
      
      if (comments.length === 0) {
        commentsList.innerHTML = '<div class="text-center py-8" style="color: #64748b;"><p>AÃºn no hay mensajes de despedida... Â¡DÃ©jame uno antes de que me vaya! ðŸ‘‹</p></div>';
        return;
      }
      
      commentsList.innerHTML = comments.map((comment, index) => {
        const date = comment.created_at || comment.date;
        return `
        <div class="p-3 rounded-lg" style="background: rgba(251, 146, 60, 0.1); border-left: 3px solid #fb923c;">
          <p style="color: #f1f5f9; margin: 0; word-break: break-word;">${escapeHtml(comment.text)}</p>
          <p style="color: #64748b; font-size: 0.85rem; margin: 4px 0 0 0;">${escapeHtml(comment.name || 'AnÃ³nimo')} â€¢ ${new Date(date).toLocaleDateString('es-ES')}</p>
        </div>
      `;
      }).join('');
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function getRandomFunnyName() {
      const funnyNames = [
        'El/La que te va a echar de menos ðŸ˜¢',
        'Tu fan nÃºmero 1 â­',
        'El/La que se queda aquÃ­ ðŸ˜…',
        'El/La que tiene envidia ðŸŸ¢',
        'El/La que te extraÃ±arÃ¡ ðŸ’”',
        'El/La que celebra tu libertad ðŸŽ‰',
        'El/La que te desea lo mejor ðŸŒŸ',
        'El/La que se queda trabajando ðŸ’¼',
        'El/La que te echarÃ¡ de menos ðŸ’œ',
        'El/La que te admira âœ¨',
        'El/La que te va a extraÃ±ar ðŸ˜­',
        'El/La que celebra contigo ðŸŽŠ',
        'El/La que te quiere mucho ðŸ’•',
        'El/La que te despedirÃ¡ con cariÃ±o ðŸ‘‹',
        'El/La que te echarÃ¡ de menos mucho ðŸ’™'
      ];
      return funnyNames[Math.floor(Math.random() * funnyNames.length)];
    }
    
    document.getElementById('comment-btn').addEventListener('click', async () => {
      const input = document.getElementById('comment-input');
      const text = input.value.trim();
      
      if (text.length > 0) {
        const name = getRandomFunnyName();
        input.value = '';
        
        // Deshabilitar botÃ³n mientras se guarda
        const btn = document.getElementById('comment-btn');
        btn.disabled = true;
        btn.textContent = 'Enviando...';
        
        await saveComment(text, name);
        
        // Rehabilitar botÃ³n
        btn.disabled = false;
        btn.textContent = 'Enviar mensaje';
        
        // Scroll to bottom
        setTimeout(() => {
          document.getElementById('comments-list').scrollTop = document.getElementById('comments-list').scrollHeight;
        }, 100);
      }
    });
    
    document.getElementById('comment-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        document.getElementById('comment-btn').click();
      }
    });
    
    // ============================================
    // INICIALIZACIÃ“N
    // ============================================
    
    // Actualizar textos personalizables
    document.getElementById('main-title').textContent = config.mainTitle;
    document.getElementById('subtitle').textContent = config.subtitle;
    document.getElementById('farewell-message').textContent = `"${config.farewellMessage}"`;
    document.getElementById('target-date-display').textContent = formatDate(targetDate);
    document.getElementById('start-date-label').textContent = formatShortDate(startDate);
    document.getElementById('end-date-label').textContent = formatShortDate(targetDate) + ' ðŸª¦';
    
    // Inicializar Supabase cuando la pÃ¡gina cargue
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSupabase);
    } else {
      initSupabase();
    }
    
    // Iniciar contador
    updateCountdown();
    setInterval(updateCountdown, 1000);
    
    // Cargar comentarios desde Supabase (esperar un poco para que Supabase se inicialice)
    setTimeout(() => {
      loadComments();
      
      // Recargar comentarios cada 5 segundos para ver nuevos mensajes
      setInterval(() => {
        loadComments();
      }, 5000);
    }, 500);
  </script>
</body>
</html>
